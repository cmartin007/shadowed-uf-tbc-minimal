# Phase 2 execution log

Brief log of completed tasks from the Ralph execution loop.

---

## 2026-02-26

- **cleanup-plan** – Created **docs/cleanup-plan.md**: single cleanup plan listing areas (lint, retail paths, dead/optional code, duplication, comments), grouped by module, with impact/priority and suggested implementation order. References docs/plan-luacheck-warnings.md and docs/CULL_INVESTIGATION.md. No code changes. Backlog `cleanup-plan` set to passes true.
- **tags-live-health-power** – Updated **modules/tags.lua** so tags `[curhp]`, `[curmaxhp]`, `[curpp]`, `[curmaxpp]`, `[perhp]`, `[perpp]` update live using TBC-safe unit events (`UNIT_HEALTH`, `UNIT_MAXHEALTH`, `UNIT_CONNECTION`, `UNIT_POWER_FREQUENT`, `UNIT_MAXPOWER`, `UNIT_DISPLAYPOWER`) wired to `fontString:UpdateTags`. Fixes player/party text showing only max values until `/reload` and keeps work per event minimal (single UnitHealth/UnitPower read + SetText).
- **hp-pp-display-polish** – Tweaked health/power text layout and color: centered `[perhp]`/`[perpp]` on the player/target bars, abbreviated large health values in `[curhp]`/`[curmaxhp]` (e.g. 12345 → 12.3k), and added new tags `[perhpclass]`, `[perppclass]`, and `[perpppowercolor]` for class- and power-colored percentages used by `modules/defaultlayout.lua`.
- **player-buff-whitelist** – Enabled player buffs on the player frame with a hardcoded whitelist (Clearcasting/16870, Tiger's Fury, Barkskin, Nature's Swiftness, Bladefist's Breadth). Whitelist is a named Lua table `playerBuffWhitelist` at the top of `defaultlayout.lua` (one entry per line, easy to edit). Supports both spell IDs (numeric keys, preferred) and names (string keys, fallback). `scanAuras` now returns `spellId` as 8th value from UnitAura (position 10) and `auraData.spellId` from C_UnitAuras. `whitelist = {}` added to AceDB defaults so `verifyTable` does not strip the table. Fixed two bugs: (1) `buildContainer` defined after `updateAuraList` — Lua resolved it as nil global and silently failed to create the container; moved `buildContainer` before `updateAuraList`. (2) auras `OnEnable` creates containers only for kinds enabled at call time; added lazy container creation in `updateAuraList` so new kinds (e.g. buffs added after frame init) become visible on next update without a re-enable.
- **self-cast-debuff-enlarge** – Rewrote `modules/auras.lua` to enlarge self-cast debuffs on the target (1.30× scale). Uses `CreateFrame("Button")` (SetScale only works on Button frames), caster detection via `playerUnits[sourceUnit]` (not `isFromPlayerOrPlayerPet` which is true for all player-type casters), and bottom-aligned positioning so mixed-scale icons share a baseline. Supports both C_UnitAuras and UnitAura fallback paths. Debuff-type-colored borders preserved.
